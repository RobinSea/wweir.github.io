---
title: "Golang 项目组织形式的演进"
date: 2018-10-25T10:38:54+08:00
lastmod: 2018-10-25T10:38:54+08:00
draft: true
tags: ["golang","git"]
categories: ["dev"]
---



很多从其它语言转 golang 的程序员都会对 `GOPATH` 这个设定感到困惑，为什么其它语言不要求把所有代码放在同一个目录，golang 就有这样一个奇怪的要求。

根据之前的了解，这是由于几位来自 google 的主要缔造者造成的。google 把所有的代码放在一个大仓库里，很好用，于是 golang 就也设计成了这种模式，把所有代码都放在一起，很好用。

## 项目代码直接放 git 目录

这样也就形成了我们最朴素，在 github 上也最常见的项目组织形式，直接把包放在 git 目录中，推上 github 等一众代码托管平台。这里最重要的，就是所有包都是以远程包的形式来使用。

但是，这也有一个大大的问题，就是所有依赖包都在远程，如果我们依赖的某个第三方库删掉或者进行了不兼容的更新，就麻烦了。同时，功夫网也给这种项目组织形式造成了很多麻烦。

## GOPATH 放 git 目录

于是 golang 提供了多 `GOPATH` 的支持，这也形成了 golang 支持 vendor（1.5，1.6） 之前主要的项目结构组织。具体来说，就是把整个 `GOPATH` 都放在 git 目录中，这样所有依赖的代码就都有备份了，只要 git 目录在，我们就一定可以进行正常开发和编译。

但是，这种组织形式是真的丑，丑出天际。各种依赖库都在本地有完整的备份，这也就包括了大量我们不需要的代码。最难受的是，各依赖库 `.git` 目录该怎么处理，这目录删掉如果删掉，就没法升级依赖库了。那么，是选择`git submodule` 、`git subtree` 还是强行把 `.git` 目录下的文件当成普通文件加到项目中？

## vendor

针对前面的问题，golang 在 1.5、1.6 的时候，又给出了新的解决方案，就是 vendor 目录的支持。发展到这里，整个项目看起来终于不那么难受了，当然，还远远算不上好。此时，我们只要把项目代码中加入 vendor 目录，并把所有依赖的代码放在 vendor 目录下就可以了。而把依赖代码放入 vendor 目录的工作，可以通过工具自动化实现，其中使用最广泛的工具是 `glide` 和 `dep`，其中 `glide` 出现较早，`dep` 作为官方推出的工具，出现较晚。

